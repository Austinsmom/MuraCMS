!function(a){function e(e){e.stopPropagation?e.stopPropagation():a.event&&(a.event.cancelBubble=!0)}function r(a){a.dataTransfer.setData("Text",""),a.dataTransfer.dropEffect="copy",dragEl=this,elDropHandled=!1,newMuraObject=!1,muraLooseDropTarget=null,muraInlineEditor.sidebarAction("showobjects"),mura(".mura-object-selected").removeClass("mura-object-selected"),mura(this).addClass("mura-object-selected")}function t(){dragEl=null,elDropHandled=!1,newMuraObject=!1,mura(".mura-object-selected").removeClass("mura-object-selected")}function o(a){if(a.preventDefault(),a.dataTransfer.dropEffect="copy",dragEl||newMuraObject){var e=mura(".mura-drop-target");muraLooseDropTarget=this,e.length&&(e.removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),e.attr("class")||e.removeAttr("class")),mura(this).addClass("mura-drop-target").addClass("mura-"+n(a,this))}}function s(a){mura(this).removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),muraLooseDropTarget=null,mura(this).attr("class")||mura(this).removeAttr("class")}function n(a,e){var r=e.getBoundingClientRect(),t=r.top,o=r.bottom,s=(o-t)/2+t;return a.clientY>s?"append":"prepend"}function d(a){var r=mura(".mura-drop-target").node;if(r&&(dragEl||newMuraObject)){if(dragEl&&dragEl!=this){var t=n(a,r);if("container"==r.getAttribute("data-object")){var o=mura(r).children(".mura-object-content");if(!o.length)return;o.node.childNodes.length?o[t](dragEl):o.append(dragEl)}else"append"==t?r.parentNode.insertBefore(dragEl,r.nextSibling):r.parentNode.insertBefore(dragEl,r);mura("#adminSave").show(),mura(r).closest(".mura-region-local").data("dirty",!0),elDropHandled=!0,e(a)}else dragEl==r&&(elDropHandled=!0,e(a));f.call(r,a)}mura(".mura-drop-target").removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),muraLooseDropTarget=null,newMuraObject=!1,mura(r).attr("class")||mura(r).removeAttr("class")}function l(a){mura(a).off("dragenter",r).off("dragover",o).off("drop",d).off("dragleave",s).on("dragstart",r).on("dragend",t).on("dragover",o).on("dragleave",s).on("drop",d).attr("draggable",!0).hover(function(a){mura(".mura-active-target").removeClass("mura-active-target");var e=mura(this);e.hasClass("mura-object-selected")||mura(this).addClass("mura-active-target")},function(a){mura(this).removeClass("mura-active-target")})}function u(a,e,r){if(a.closest(".mura-region").length){for(var t=a.parent().closest(".mura-object");t.length&&"container"!=t.data("object");)a=t,t=t.parent().closest(".mura-object");a.length&&a.addClass("mura-drop-target").addClass("mura-"+n(e,r))}}function i(a){if(a.preventDefault(),a.dataTransfer.dropEffect="copy",!mura(".mura-drop-target").length&&(dragEl||newMuraObject)){var e=mura(this).closest(".mura-object");e.length?u(e,a,this):mura(this).addClass("mura-drop-target").addClass("mura-"+n(a,this))}}function m(a){if(a.preventDefault(),dragEl||newMuraObject){var e=mura(".mura-drop-target");muraLooseDropTarget=this,e.length&&(e.removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),e.attr("class")||e.removeAttr("class"));var r=mura(this).closest(".mura-object");r.length?u(r,a,this):(r=mura(this).closest(".mura-object"),r.length?r.addClass("mura-drop-target").addClass("mura-"+n(a,this)):mura(this).addClass("mura-drop-target").addClass("mura-"+n(a,this)))}}function c(a){mura(this).removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),muraLooseDropTarget=null,mura(this).attr("class")||mura(this).removeAttr("class")}function g(a){if(e(a),dragEl||newMuraObject){var r=mura(".mura-drop-target").node;if(r){if(dragEl&&dragEl!=r){var t=n(a,r);if("container"==r.getAttribute("data-object")){var o=mura(r).children(".mura-object-content");o.node.childNodes.length?o[t](dragEl):o.append(dragEl)}else try{"append"==t?r.parentNode.insertBefore(dragEl,r.nextSibling):r.parentNode.insertBefore(dragEl,r)}catch(a){}var s=mura(dragEl);mura("#adminSave").show(),s.addClass("mura-async-object"),"text"==s.data("object")&&"client"==s.data("render")&&"false"==s.data("async")||s.data("async",!0),mura(r).closest(".mura-region-local").data("dirty",!0),l(r),elDropHandled=!0,e(a)}else dragEl==r&&(elDropHandled=!0,e(a));f.call(r,a)}}mura(".mura-drop-target").removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),muraLooseDropTarget=null,newMuraObject=!1,mura(this).attr("class")||mura(this).removeAttr("class")}function p(a){mura(a).off("dragenter",i).off("dragover",m).off("drop",g).off("dragleave",c).on("dragenter",i).on("dragover",m).on("dragleave",c).on("drop",g)}function h(){mura(".mura-objectclass").each(function(){var a=mura(this);a.data("inited")||(a.attr("draggable",!0),a.on("dragstart",function(e){dragEl=null,elDropHandled=!1,newMuraObject=!0,muraLooseDropTarget=null,mura("#dragtype").html(a.data("object")),mura(".mura-sidebar").addClass("mura-sidebar--dragging"),e.dataTransfer.setData("text",JSON.stringify({object:a.data("object"),objectname:a.data("objectname"),objectid:a.data("objectid"),objecticonclass:a.data("objecticonclass")}))}).on("dragend",function(){mura("#dragtype").html(""),dragEl=null,elDropHandled=!1,newMuraObject=!1,mura(".mura-sidebar").removeClass("mura-sidebar--dragging")}),a.data("inited",!0))})}function f(a){a.preventDefault(),a.stopPropagation&&a.stopPropagation();var r=a.dataTransfer.getData("text");if(""!=r)try{r=JSON.parse(r)}catch(a){r=""}if("object"==typeof r&&r.object){var t=document.createElement("DIV");t.setAttribute("data-object",r.object),t.setAttribute("data-objectname",r.objectname),t.setAttribute("data-objecticonclass",r.objecticonclass),t.setAttribute("data-async",!0),t.setAttribute("data-perm","author"),t.setAttribute("data-instanceid",mura.createUUID()),t.setAttribute("class","mura-async-object mura-object mura-active"),r.objectid?t.setAttribute("data-objectid",r.objectid):t.setAttribute("data-objectid",mura.createUUID());var o=mura(this),s=n(a,this);if(o.hasClass("mura-object"))if("container"==this.getAttribute("data-object")){var d=o.children(".mura-object-content");d.node.childNodes.length?d[s](t):d.append(t)}else"append"==s?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.insertBefore(t,this);else o.hasClass("mura-region-local")?this.appendChild(t):"append"==s?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.insertBefore(t,this);l(t),muraInlineEditor.objectHasConfigurator(mura(t))&&openFrontEndToolsModal(t),mura.processAsyncObject(t),mura(t).closest(".mura-region-local").data("dirty",!0),mura(t).on("dragover",function(){}),mura("#adminSave").show(),e(a)}}function b(a,e,r,t,o,s){var n="muraAction=cArch.loadclass&compactDisplay=true&layoutmanager=true&siteid="+a+"&classid="+e+"&subclassid="+r+"&contentid="+t+"&parentid="+o+"&cacheid="+Math.random();if("plugins"==e)var d=mura("#pluginList");else{var d=mura("#classList");mura("#classListContainer").show()}return d.html(mura.preloaderMarkup),mura.ajax({url:mura.adminpath+"?"+n,success:function(a){d.html(a),h()}}),!1}function v(a){mura.loader().loadjs(mura.adminpath+"/assets/js/ios-drag-drop.js",function(){if(a){var r=a.node?a:mura(a);a=a.node||a}else{var r=mura("body");a=r.node,h(),mura("body").removeClass("mura-sidebar-state__hidden--right").addClass("mura-sidebar-state__pushed--right")}var t=mura("#frontEndToolsSidebariframe");t.attr("src",t.data("preloadsrc")),r.find(".mxp-editable").each(function(){var a=mura(this);a.hasClass("mura-region-local")||(a.addClass("mura-region-local"),a.data("inited",!1),a.data("loose",!0))}),r.find('.mura-region-local[data-inited="false"]').each(function(){var a=mura(this);(!a.data("loose")||a.data("loose")&&"<p></p>"==a.html()||""==mura.trim(a.html()))&&a.on("drop",function(a){var r,t,o;return a.preventDefault(),mura(this).find(".mura-object").length?void 0:(a.stopPropagation&&a.stopPropagation(),dragEl&&dragEl!==this?(r=this.parentNode,o=C(dragEl.parentNode.children).indexOf(dragEl),t=C(this.parentNode.children).indexOf(this),this.parentNode===dragEl.parentNode&&t>o?r.insertBefore(dragEl,this.nextSibling):this.appendChild(dragEl),mura("#adminSave").show(),mura(dragEl).data("async",!0),mura(dragEl).addClass("mura-async-object"),mura(this).data("dirty",!0),elDropHandled=!0,e(a)):dragEl==this&&(elDropHandled=!0,e(a)),f.call(this,a),muraLooseDropTarget=null,mura(".mura-drop-target").removeClass("mura-drop-target").removeClass("mura-append").removeClass("mura-prepend"),!0)}).on("dragover",function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy"}).data("inited","true")}),r.find(".mura-region-local .mura-object").each(function(){l(this)}),r.find('.mura-object[data-object="container"], .mura-region-local div, .mura-region-local[data-loose="true"] p, .mura-region-local[data-loose="true"] h1, .mura-region-local[data-loose="true"] h2, .mura-region-local[data-loose="true"] h3, .mura-region-local[data-loose="true"] h4, .mura-region-local[data-loose="true"] img, .mura-region-local[data-loose="true"] table, .mura-region-local[data-loose="true"] article, .mura-region-local[data-loose="true"] dl').each(function(){p(this)}),r.find('.mura-body-object,.mura-object[data-object="folder"],.mura-object[data-object="calendar"],.mura-object[data-object="gallery"]').hover(function(a){mura(".mura-active-target").removeClass("mura-active-target");var e=mura(this);e.hasClass("mura-object-selected")||mura(this).addClass("mura-active-target")},function(a){mura(this).removeClass("mura-active-target")})})}var j,C=function(a,e,r){return Array.prototype.slice.call(a,e,r)},E;mura.initLayoutManager=v,mura.loadObjectClass=b,mura.initLooseDropTarget=p,mura.initDraggableObject=l}(window);